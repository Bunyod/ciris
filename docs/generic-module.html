<html><head><title>Ciris: Generic Module</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Viktor Lövgren" /><meta name="description" content="Lightweight, extensible, and validated configuration loading in Scala" /><meta name="og:image" content="/img/poster.png" /><meta name="og:title" content="Ciris: Generic Module" /><meta name="og:site_name" content="Ciris" /><meta name="og:url" content="https://cir.is" /><meta name="og:type" content="website" /><meta name="og:description" content="Lightweight, extensible, and validated configuration loading in Scala" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Ciris: Generic Module" /><meta name="twitter:image" content="https://cir.isimg/poster.png" /><meta name="twitter:description" content="Lightweight, extensible, and validated configuration loading in Scala" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@vlovgr" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /><link rel="stylesheet" href="/css/custom.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>Ciris</span></div></a></li> <li><a href="/docs/basics" class="">Usage Basics</a></li> <li><a href="/docs/topics" class="">Configuration Topics</a> <ul class="sub_section"> <li><a href="/docs/validation" class="">Encoding Validation</a></li> <li><a href="/docs/environments" class="">Multiple Environments</a></li> <li><a href="/docs/logging" class="">Logging Configurations</a></li></ul></li> <li><a href="/docs/sources" class="">Configuration Sources</a> <ul class="sub_section"> <li><a href="/docs/supported-sources" class="">Current Supported Sources</a></li> <li><a href="/docs/supporting-new-sources" class="">Supporting New Sources</a></li></ul></li> <li><a href="/docs/decoders" class="">Configuration Decoders</a> <ul class="sub_section"> <li><a href="/docs/supported-types" class="">Current Supported Types</a></li> <li><a href="/docs/supporting-new-types" class="">Supporting New Types</a></li></ul></li> <li><a href="/docs/modules" class="">Modules Overview</a> <ul class="sub_section"> <li><a href="/docs/cats-module" class="">Cats Module</a></li> <li><a href="/docs/cats-effect-module" class="">Cats Effect Module</a></li> <li><a href="/docs/enumeratum-module" class="">Enumeratum Module</a></li> <li><a href="/docs/generic-module" class=" active ">Generic Module</a></li> <li><a href="/docs/refined-module" class="">Refined Module</a></li> <li><a href="/docs/spire-module" class="">Spire Module</a></li> <li><a href="/docs/squants-module" class="">Squants Module</a></li></ul></li> <li><a href="/docs/contributing" class="">Contributing Guide</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/vlovgr/ciris"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/vlovgr/ciris"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="vlovgr" data-github-repo="ciris"><div class="content-wrapper"><section><h1 id="generic-module">Generic Module</h1>
<p>The <code class="highlighter-rouge">ciris-generic</code> module provides the ability to decode products and coproducts using <a href="https://github.com/milessabin/shapeless">shapeless</a>. This allows you to decode case classes, <a href="http://docs.scala-lang.org/overviews/core/value-classes.html">value classes</a>, and shapeless coproducts, plus anything else that shapeless <code class="highlighter-rouge">Generic</code> supports. Note that care has been taken to make sure the generic module does not override default behaviours defined in the core module. The generic module might still override other defined behaviours, so use with care.</p>

<p>Let’s take a look at some examples. We start by defining a source from which we can read configuration values.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">ciris.</span><span class="o">{</span><span class="nc">ConfigKeyType</span><span class="o">,</span> <span class="nc">ConfigSource</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">ciris.generic._</span>

<span class="k">val</span> <span class="n">source</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">keyType</span> <span class="k">=</span> <span class="nc">ConfigKeyType</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">"generic key"</span><span class="o">)</span>
  <span class="nc">ConfigSource</span><span class="o">.</span><span class="n">fromEntries</span><span class="o">(</span><span class="n">keyType</span><span class="o">)(</span><span class="s">"key"</span> <span class="o">-&gt;</span> <span class="s">"5.0"</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We can then define and load a unary product, for example a case class with one value.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">DoubleValue</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span>
<span class="c1">// defined class DoubleValue
</span>
<span class="n">source</span><span class="o">.</span><span class="n">read</span><span class="o">(</span><span class="s">"key"</span><span class="o">).</span><span class="n">decodeValue</span><span class="o">[</span><span class="kt">DoubleValue</span><span class="o">]</span>
<span class="c1">// res0: ciris.ConfigEntry[ciris.api.Id,String,String,DoubleValue] = ConfigEntry(key, ConfigKeyType(generic key))
</span></code></pre></div></div>

<p>It also works for value classes and any other unary products shapeless <code class="highlighter-rouge">Generic</code> supports.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">FloatValue</span><span class="o">(</span><span class="k">val</span> <span class="n">value</span><span class="k">:</span> <span class="kt">Float</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">AnyVal</span>
<span class="c1">// defined class FloatValue
</span>
<span class="n">source</span><span class="o">.</span><span class="n">read</span><span class="o">(</span><span class="s">"key"</span><span class="o">).</span><span class="n">decodeValue</span><span class="o">[</span><span class="kt">FloatValue</span><span class="o">]</span>
<span class="c1">// res1: ciris.ConfigEntry[ciris.api.Id,String,String,FloatValue] = ConfigEntry(key, ConfigKeyType(generic key))
</span></code></pre></div></div>

<p>If we define a product with more than one value:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">TwoValues</span><span class="o">(</span><span class="n">value1</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">value2</span><span class="k">:</span> <span class="kt">Float</span><span class="o">)</span>
<span class="c1">// defined class TwoValues
</span></code></pre></div></div>

<p>we will try to decode it twice, once as a <code class="highlighter-rouge">Double</code>, and once as a <code class="highlighter-rouge">Float</code>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span><span class="o">.</span><span class="n">read</span><span class="o">(</span><span class="s">"key"</span><span class="o">).</span><span class="n">decodeValue</span><span class="o">[</span><span class="kt">TwoValues</span><span class="o">]</span>
<span class="c1">// res2: ciris.ConfigEntry[ciris.api.Id,String,String,TwoValues] = ConfigEntry(key, ConfigKeyType(generic key))
</span></code></pre></div></div>

<p>You can also customize the decoding on a per-type basis. For example, if you have a <a href="/api/ciris/ConfigSource.html"><code class="highlighter-rouge">ConfigSource</code></a> which reads values of type <code class="highlighter-rouge">Map[String, String]</code>, you can customize which key gets decoded for which type, as in the example below.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">ciris.ConfigDecoder</span>
<span class="c1">// import ciris.ConfigDecoder
</span>
<span class="k">val</span> <span class="n">mapSource</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">keyType</span> <span class="k">=</span> <span class="nc">ConfigKeyType</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">"generic key"</span><span class="o">)</span>
  <span class="nc">ConfigSource</span><span class="o">.</span><span class="n">fromEntries</span><span class="o">(</span><span class="n">keyType</span><span class="o">)(</span>
    <span class="s">"key"</span> <span class="o">-&gt;</span> <span class="nc">Map</span><span class="o">(</span>
      <span class="s">"key1"</span> <span class="o">-&gt;</span> <span class="s">"1.0"</span><span class="o">,</span>
      <span class="s">"key2"</span> <span class="o">-&gt;</span> <span class="s">"2.0"</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">}</span>
<span class="c1">// mapSource: ciris.ConfigSource[ciris.api.Id,String,scala.collection.immutable.Map[String,String]] = ConfigSource(ConfigKeyType(generic key))
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">decodeDouble</span><span class="k">:</span> <span class="kt">ConfigDecoder</span><span class="o">[</span><span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">ConfigDecoder</span><span class="o">.</span><span class="n">catchNonFatal</span><span class="o">(</span><span class="s">"Double"</span><span class="o">)(</span><span class="n">map</span> <span class="k">=&gt;</span> <span class="n">map</span><span class="o">(</span><span class="s">"key1"</span><span class="o">).</span><span class="n">toDouble</span><span class="o">)</span>
<span class="c1">// decodeDouble: ciris.ConfigDecoder[Map[String,String],Double] = ConfigDecoder$641444178
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">decodeFloat</span><span class="k">:</span> <span class="kt">ConfigDecoder</span><span class="o">[</span><span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span>, <span class="kt">Float</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">ConfigDecoder</span><span class="o">.</span><span class="n">catchNonFatal</span><span class="o">(</span><span class="s">"Float"</span><span class="o">)(</span><span class="n">map</span> <span class="k">=&gt;</span> <span class="n">map</span><span class="o">(</span><span class="s">"key2"</span><span class="o">).</span><span class="n">toFloat</span><span class="o">)</span>
<span class="c1">// decodeFloat: ciris.ConfigDecoder[Map[String,String],Float] = ConfigDecoder$1338783157
</span>
<span class="n">mapSource</span><span class="o">.</span><span class="n">read</span><span class="o">(</span><span class="s">"key"</span><span class="o">).</span><span class="n">decodeValue</span><span class="o">[</span><span class="kt">TwoValues</span><span class="o">]</span>
<span class="c1">// res3: ciris.ConfigEntry[ciris.api.Id,String,scala.collection.immutable.Map[String,String],TwoValues] = ConfigEntry(key, ConfigKeyType(generic key))
</span></code></pre></div></div>

<p>We can also define a shapeless coproduct and attempt to decode it.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">shapeless.</span><span class="o">{:+:,</span> <span class="nc">CNil</span><span class="o">}</span>
<span class="c1">// import shapeless.{$colon$plus$colon, CNil}
</span>
<span class="k">type</span> <span class="kt">DoubleOrFloat</span> <span class="o">=</span> <span class="nc">DoubleValue</span> <span class="o">:+:</span> <span class="nc">FloatValue</span> <span class="o">:+:</span> <span class="nc">CNil</span>
<span class="c1">// defined type alias DoubleOrFloat
</span>
<span class="n">source</span><span class="o">.</span><span class="n">read</span><span class="o">(</span><span class="s">"key"</span><span class="o">).</span><span class="n">decodeValue</span><span class="o">[</span><span class="kt">DoubleOrFloat</span><span class="o">]</span>
<span class="c1">// res4: ciris.ConfigEntry[ciris.api.Id,String,String,DoubleOrFloat] = ConfigEntry(key, ConfigKeyType(generic key))
</span></code></pre></div></div>

<p>If there is no public constructor or <code class="highlighter-rouge">apply</code> method:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">object</span> <span class="nc">PrivateValues</span> <span class="o">{</span>
  <span class="k">final</span> <span class="k">class</span> <span class="nc">PrivateFloatValue</span> <span class="k">private</span><span class="o">(</span><span class="k">val</span> <span class="n">value</span><span class="k">:</span> <span class="kt">Float</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">AnyVal</span>
  <span class="k">object</span> <span class="nc">PrivateFloatValue</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">withValue</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Float</span><span class="o">)</span> <span class="k">=</span>
      <span class="k">new</span> <span class="nc">PrivateFloatValue</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// defined object PrivateValues
</span>
<span class="k">import</span> <span class="nn">PrivateValues._</span>
<span class="c1">// import PrivateValues._
</span></code></pre></div></div>

<p>we will not be able to decode values, resulting in an error at compile-time.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span><span class="o">.</span><span class="n">read</span><span class="o">(</span><span class="s">"key"</span><span class="o">).</span><span class="n">decodeValue</span><span class="o">[</span><span class="kt">PrivateFloatValue</span><span class="o">]</span>
<span class="c1">// &lt;console&gt;:26: error: could not find implicit value for parameter decoder: ciris.ConfigDecoder[String,PrivateValues.PrivateFloatValue]
//        source.read("key").decodeValue[PrivateFloatValue]
//                                      ^
</span></code></pre></div></div>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script src="/js/custom.js"></script><script>((window.gitter = {}).chat = {}).options = {
room: 'vlovgr/ciris'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/main.js"></script></body></html>