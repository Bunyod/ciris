<html><head><title>Ciris: Supporting New Types</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Viktor Lövgren" /><meta name="description" content="Lightweight, extensible, and validated configuration loading in Scala" /><meta name="og:image" content="/img/poster.png" /><meta name="og:title" content="Ciris: Supporting New Types" /><meta name="og:site_name" content="Ciris" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Lightweight, extensible, and validated configuration loading in Scala" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Ciris: Supporting New Types" /><meta name="twitter:image" content="img/poster.png" /><meta name="twitter:description" content="Lightweight, extensible, and validated configuration loading in Scala" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@vlovgr" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /><link rel="stylesheet" href="/css/custom.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-37804684-4' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>Ciris</span></div></a></li> <li><a href="/docs/basics" class="">Usage Basics</a></li> <li><a href="/docs/topics" class="">Configuration Topics</a> <ul class="sub_section"> <li><a href="/docs/validation" class="">Encoding Validation</a></li> <li><a href="/docs/environments" class="">Multiple Environments</a></li> <li><a href="/docs/logging" class="">Logging Configurations</a></li></ul></li> <li><a href="/docs/sources" class="">Configuration Sources</a> <ul class="sub_section"> <li><a href="/docs/supported-sources" class="">Current Supported Sources</a></li> <li><a href="/docs/supporting-new-sources" class="">Supporting New Sources</a></li></ul></li> <li><a href="/docs/decoders" class="">Configuration Decoders</a> <ul class="sub_section"> <li><a href="/docs/supported-types" class="">Current Supported Types</a></li> <li><a href="/docs/supporting-new-types" class=" active ">Supporting New Types</a></li></ul></li> <li><a href="/docs/modules" class="">Modules Overview</a> <ul class="sub_section"> <li><a href="/docs/cats-module" class="">Cats Module</a></li> <li><a href="/docs/cats-effect-module" class="">Cats Effect Module</a></li> <li><a href="/docs/enumeratum-module" class="">Enumeratum Module</a></li> <li><a href="/docs/generic-module" class="">Generic Module</a></li> <li><a href="/docs/refined-module" class="">Refined Module</a></li> <li><a href="/docs/spire-module" class="">Spire Module</a></li> <li><a href="/docs/squants-module" class="">Squants Module</a></li></ul></li> <li><a href="/docs/contributing" class="">Contributing Guide</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/vlovgr/ciris"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/vlovgr/ciris"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="vlovgr" data-github-repo="ciris"><div class="content-wrapper"><section><h1 id="supporting-new-types">Supporting New Types</h1>
<p>There may be times when you need to write decoders for custom types, when the type isn’t already supported. Decoders are represented with <a href="/api/ciris/ConfigDecoder.html"><code class="highlighter-rouge">ConfigDecoder</code></a>s and include several combinators for creating new decoders from existing ones. The <a href="/api/ciris/ConfigDecoder$.html">companion object</a> of <a href="/api/ciris/ConfigDecoder.html"><code class="highlighter-rouge">ConfigDecoder</code></a> also contain several functions for helping you create new decoders. Following, we’ll show how to write decoding support for a custom <code class="highlighter-rouge">Odd</code> type representing odd numbers.</p>

<p>Let’s say you’re dealing with a sealed <code class="highlighter-rouge">Odd</code> class, where you can only construct instances using an <code class="highlighter-rouge">odd</code> method, which accepts an <code class="highlighter-rouge">Int</code> and returns an <code class="highlighter-rouge">Option[Odd]</code>. Note that an alternative way to represent <code class="highlighter-rouge">Odd</code> values is by using the <code class="highlighter-rouge">Odd</code> predicate from <a href="/docs/refined-module">refined</a>, which saves you having to write custom decoders. However, there may be times when you need to resort to custom types, so <code class="highlighter-rouge">Odd</code> is simply serving as an example here.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">sealed</span> <span class="k">abstract</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Odd</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>

<span class="k">def</span> <span class="n">odd</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Odd</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="nc">Option</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>
    <span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="k">_</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span>
    <span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">new</span> <span class="nc">Odd</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="o">{})</span>
<span class="o">}</span>
</code></pre>
</div>

<p>When we try to decode values of type <code class="highlighter-rouge">Odd</code>, we’ll get an error at compile-time.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="o">{</span>
  <span class="k">import</span> <span class="nn">ciris.env</span>
  <span class="n">env</span><span class="o">[</span><span class="kt">Odd</span><span class="o">](</span><span class="s">"SHLVL"</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// &lt;console&gt;:17: error: could not find implicit value for parameter decoder: ciris.ConfigDecoder[String,Odd]
//          env[Odd]("SHLVL")
//                  ^
</span></code></pre>
</div>

<p>As the error suggests, we’ll have to define an implicit <code class="highlighter-rouge">ConfigDecoder[String, Odd]</code> instance and include it in scope. We can take this one step further, by saying that if there is a <code class="highlighter-rouge">ConfigDecoder[A, Int]</code> instance available, we can provide a <code class="highlighter-rouge">ConfigDecoder[A, Odd]</code> instance. The <a href="/api/ciris/ConfigDecoder.html#mapOption[C](typeName:String)(f:B=&gt;Option[C]):ciris.ConfigDecoder[A,C]"><code class="highlighter-rouge">mapOption</code></a> function on <a href="/api/ciris/ConfigDecoder.html"><code class="highlighter-rouge">ConfigDecoder</code></a> can be used to convert the <code class="highlighter-rouge">Int</code> to an <code class="highlighter-rouge">Odd</code>. Most <a href="/api/ciris/ConfigDecoder.html"><code class="highlighter-rouge">ConfigDecoder</code></a> functions accept a <code class="highlighter-rouge">typeName</code> argument, which is the name of the type we are attempting to decode. In this case, and in general when the type you’re dealing with does not have type parameters, it’s simple enough to provide the type name. When dealing with types with type parameters, you might have to resort to using <a href="https://docs.scala-lang.org/overviews/reflection/typetags-manifests.html">type tags</a>, depending on the platform you’re running on (Scala, Scala.js, Scala Native).</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">ciris.ConfigDecoder</span>
<span class="c1">// import ciris.ConfigDecoder
</span>
<span class="k">implicit</span> <span class="k">def</span> <span class="n">oddConfigDecoder</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span>
  <span class="k">implicit</span> <span class="n">decoder</span><span class="k">:</span> <span class="kt">ConfigDecoder</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">Int</span><span class="o">]</span>
<span class="o">)</span><span class="k">:</span> <span class="kt">ConfigDecoder</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">Odd</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="n">decoder</span><span class="o">.</span><span class="n">mapOption</span><span class="o">(</span><span class="s">"Odd"</span><span class="o">)(</span><span class="n">odd</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// oddConfigDecoder: [A](implicit decoder: ciris.ConfigDecoder[A,Int])ciris.ConfigDecoder[A,Odd]
</span></code></pre>
</div>

<p>If we now try to decode an <code class="highlighter-rouge">Odd</code> value, we should no longer get an error at compile-time.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">ciris.env</span>
<span class="c1">// import ciris.env
</span>
<span class="n">env</span><span class="o">[</span><span class="kt">Odd</span><span class="o">](</span><span class="s">"SHLVL"</span><span class="o">)</span>
<span class="c1">// res2: ciris.ConfigEntry[ciris.api.Id,String,String,Odd] = ConfigEntry(SHLVL, Environment, Right(2), Left(WrongType(SHLVL, Environment, Right(2), 2, Odd)))
</span></code></pre>
</div>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/js/custom.js"></script><script>((window.gitter = {}).chat = {}).options = {
room: 'vlovgr/ciris'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/main.js"></script></body></html>